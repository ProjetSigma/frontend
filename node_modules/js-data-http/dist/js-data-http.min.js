/*!
* js-data-http
* @version 3.0.0-rc.2 - Homepage <https://github.com/js-data/js-data-http>
* @copyright (c) 2014-2016 js-data-http project authors
* @license MIT <https://github.com/js-data/js-data-http/blob/master/LICENSE>
*
* @overview HTTP (XHR) adapter for js-data in the browser.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("js-data")):"function"==typeof define&&define.amd?define("js-data-http",["exports","js-data"],e):e(t.JSDataHttp=t.JSDataHttp||{},t.JSData)}(this,function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function r(t,e){return e={exports:{}},t(e,e.exports),e.exports}function i(t,n,r){n||(n={}),this.data=t,e.utils.fillIn(this,n),this.op=r}function o(t){e.utils.classCallCheck(this,o),e.Component.call(this,t),t||(t={}),e.utils.fillIn(t,E),e.utils.fillIn(this,t)}function a(t){return null!=t&&""!==t}function s(t,e){return e||(e=""),t.filter(a).join(e)}function u(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=s(e,"/");return r.replace(/([^:\/]|^)\/{2,}/g,"$1/")}function f(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function l(t,n){if(!n)return t;var r=[];return e.utils.forOwn(n,function(t,n){null!==t&&"undefined"!=typeof t&&(e.utils.isArray(t)||(t=[t]),t.forEach(function(t){"[object Date]"===window.toString.call(t)?t=t.toISOString():e.utils.isObject(t)&&(t=e.utils.toJson(t)),r.push(f(n)+"="+f(t))}))}),r.length>0&&(t+=(t.indexOf("?")===-1?"?":"&")+r.join("&")),t}function c(t){e.utils.classCallCheck(this,c),t||(t={}),e.utils.fillIn(t,P),o.call(this,t)}function d(t,n){if(!t||!e.utils.isString(t))throw new TypeError("action(name[, opts]): Expected: string, Found: "+("undefined"==typeof t?"undefined":m(t)));return function(r){if(r[t])throw new Error("action(name[, opts]): "+t+" already exists on target!");return n.request=n.request||function(t){return t},n.response=n.response||function(t){return t},n.responseError=n.responseError||function(t){return e.utils.reject(t)},r[t]=function(r,i){var o=this;e.utils.isObject(r)&&(i=r),i=i||{};var a=this.getAdapter(n.adapter||this.defaultAdapter||"http"),s={};if(e.utils.fillIn(s,n),!i.hasOwnProperty("endpoint")&&s.endpoint&&(i.endpoint=s.endpoint),"function"==typeof i.getEndpoint)s.url=i.getEndpoint(this,i);else{var f=[i.basePath||this.basePath||a.basePath,a.getEndpoint(this,e.utils.isSorN(r)?r:null,i)];e.utils.isSorN(r)&&f.push(r),f.push(n.pathname||t),s.url=u.apply(null,f)}return s.method=s.method||"GET",s.mapper=this.name,e.utils.deepMixIn(s,i),e.utils.resolve(s).then(i.request||n.request).then(function(t){return a.HTTP(t)}).then(function(t){return t&&t.config&&(t.config.mapper=o.name),t}).then(i.response||n.response,i.responseError||n.responseError)},r}}function p(t){return t||(t={}),function(n){return e.utils.forOwn(t,function(t,e){d(e,t)(n)}),n}}var h="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},y=r(function(t,e){!function(n,r){"object"==typeof e&&"object"==typeof t?t.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof e?e.axios=r():n.axios=r()}(h,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){function r(t){var e=new a(t),n=o(a.prototype.request,e);return i.extend(n,a.prototype,e),i.extend(n,e),n}var i=n(2),o=n(3),a=n(4),s=t.exports=r();s.Axios=a,s.create=function(t){return r(t)},s.all=function(t){return Promise.all(t)},s.spread=n(21)},function(t,e,n){function r(t){return"[object Array]"===T.call(t)}function i(t){return"[object ArrayBuffer]"===T.call(t)}function o(t){return"undefined"!=typeof FormData&&t instanceof FormData}function a(t){var e;return e="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer}function s(t){return"string"==typeof t}function u(t){return"number"==typeof t}function f(t){return"undefined"==typeof t}function l(t){return null!==t&&"object"==typeof t}function c(t){return"[object Date]"===T.call(t)}function d(t){return"[object File]"===T.call(t)}function p(t){return"[object Blob]"===T.call(t)}function h(t){return"[object Function]"===T.call(t)}function y(t){return l(t)&&h(t.pipe)}function v(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}function m(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}function g(){return"undefined"!=typeof window&&"undefined"!=typeof document&&"function"==typeof document.createElement}function b(t,e){if(null!==t&&"undefined"!=typeof t)if("object"==typeof t||r(t)||(t=[t]),r(t))for(var n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else for(var o in t)t.hasOwnProperty(o)&&e.call(null,t[o],o,t)}function w(){function t(t,n){"object"==typeof e[n]&&"object"==typeof t?e[n]=w(e[n],t):e[n]=t}for(var e={},n=0,r=arguments.length;n<r;n++)b(arguments[n],t);return e}function x(t,e,n){return b(e,function(e,r){n&&"function"==typeof e?t[r]=A(e,n):t[r]=e}),t}var A=n(3),T=Object.prototype.toString;t.exports={isArray:r,isArrayBuffer:i,isFormData:o,isArrayBufferView:a,isString:s,isNumber:u,isObject:l,isUndefined:f,isDate:c,isFile:d,isBlob:p,isFunction:h,isStream:y,isURLSearchParams:v,isStandardBrowserEnv:g,forEach:b,merge:w,extend:x,trim:m}},function(t,e){t.exports=function(t,e){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return t.apply(e,n)}}},function(t,e,n){function r(t){this.defaults=o.merge(i,t),this.interceptors={request:new a,response:new a}}var i=n(5),o=n(2),a=n(7),s=n(8),u=n(19),f=n(20);r.prototype.request=function(t){"string"==typeof t&&(t=o.merge({url:arguments[0]},arguments[1])),t=o.merge(i,this.defaults,{method:"get"},t),t.baseURL&&!u(t.url)&&(t.url=f(t.baseURL,t.url));var e=[s,void 0],n=Promise.resolve(t);for(this.interceptors.request.forEach(function(t){e.unshift(t.fulfilled,t.rejected)}),this.interceptors.response.forEach(function(t){e.push(t.fulfilled,t.rejected)});e.length;)n=n.then(e.shift(),e.shift());return n},o.forEach(["delete","get","head"],function(t){r.prototype[t]=function(e,n){return this.request(o.merge(n||{},{method:t,url:e}))}}),o.forEach(["post","put","patch"],function(t){r.prototype[t]=function(e,n,r){return this.request(o.merge(r||{},{method:t,url:e,data:n}))}}),t.exports=r},function(t,e,n){function r(t,e){!i.isUndefined(t)&&i.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var i=n(2),o=n(6),a=/^\)\]\}',?\n/,s={"Content-Type":"application/x-www-form-urlencoded"};t.exports={transformRequest:[function(t,e){return o(e,"Content-Type"),i.isFormData(t)||i.isArrayBuffer(t)||i.isStream(t)||i.isFile(t)||i.isBlob(t)?t:i.isArrayBufferView(t)?t.buffer:i.isURLSearchParams(t)?(r(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):i.isObject(t)?(r(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t){t=t.replace(a,"");try{t=JSON.parse(t)}catch(t){}}return t}],headers:{common:{Accept:"application/json, text/plain, */*"},patch:i.merge(s),post:i.merge(s),put:i.merge(s)},timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}}},function(t,e,n){var r=n(2);t.exports=function(t,e){r.forEach(t,function(n,r){r!==e&&r.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[r])})}},function(t,e,n){function r(){this.handlers=[]}var i=n(2);r.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},r.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},r.prototype.forEach=function(t){i.forEach(this.handlers,function(e){null!==e&&t(e)})},t.exports=r},function(t,e,n){var r=n(2),i=n(9);t.exports=function(t){t.headers=t.headers||{},t.data=i(t.data,t.headers,t.transformRequest),t.headers=r.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),r.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]});var e;return"function"==typeof t.adapter?e=t.adapter:"undefined"!=typeof XMLHttpRequest?e=n(10):"undefined"!=typeof process&&(e=n(10)),Promise.resolve(t).then(e).then(function(e){return e.data=i(e.data,e.headers,t.transformResponse),e},function(e){return e&&e.response&&(e.response.data=i(e.response.data,e.response.headers,t.transformResponse)),Promise.reject(e)})}},function(t,e,n){var r=n(2);t.exports=function(t,e,n){return r.forEach(n,function(n){t=n(t,e)}),t}},function(t,e,n){var r=n(2),i=n(11),o=n(14),a=n(15),s=n(16),u=n(12),f="undefined"!=typeof window&&window.btoa||n(17);t.exports=function(t){return new Promise(function(e,l){var c=t.data,d=t.headers;r.isFormData(c)&&delete d["Content-Type"];var p=new XMLHttpRequest,h="onreadystatechange",y=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in p||s(t.url)||(p=new window.XDomainRequest,h="onload",y=!0,p.onprogress=function(){},p.ontimeout=function(){}),t.auth){var v=t.auth.username||"",m=t.auth.password||"";d.Authorization="Basic "+f(v+":"+m)}if(p.open(t.method.toUpperCase(),o(t.url,t.params,t.paramsSerializer),!0),p.timeout=t.timeout,p[h]=function(){if(p&&(4===p.readyState||y)&&0!==p.status){var n="getAllResponseHeaders"in p?a(p.getAllResponseHeaders()):null,r=t.responseType&&"text"!==t.responseType?p.response:p.responseText,o={data:r,status:1223===p.status?204:p.status,statusText:1223===p.status?"No Content":p.statusText,headers:n,config:t,request:p};i(e,l,o),p=null}},p.onerror=function(){l(u("Network Error",t)),p=null},p.ontimeout=function(){l(u("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED")),p=null},r.isStandardBrowserEnv()){var g=n(18),b=t.withCredentials||s(t.url)?g.read(t.xsrfCookieName):void 0;b&&(d[t.xsrfHeaderName]=b)}if("setRequestHeader"in p&&r.forEach(d,function(t,e){"undefined"==typeof c&&"content-type"===e.toLowerCase()?delete d[e]:p.setRequestHeader(e,t)}),t.withCredentials&&(p.withCredentials=!0),t.responseType)try{p.responseType=t.responseType}catch(t){if("json"!==p.responseType)throw t}"function"==typeof t.progress&&("post"===t.method||"put"===t.method?p.upload.addEventListener("progress",t.progress):"get"===t.method&&p.addEventListener("progress",t.progress)),void 0===c&&(c=null),p.send(c)})}},function(t,e,n){var r=n(12);t.exports=function(t,e,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(r("Request failed with status code "+n.status,n.config,null,n)):t(n)}},function(t,e,n){var r=n(13);t.exports=function(t,e,n,i){var o=new Error(t);return r(o,e,n,i)}},function(t,e){t.exports=function(t,e,n,r){return t.config=e,n&&(t.code=n),t.response=r,t}},function(t,e,n){function r(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var i=n(2);t.exports=function(t,e,n){if(!e)return t;var o;if(n)o=n(e);else if(i.isURLSearchParams(e))o=e.toString();else{var a=[];i.forEach(e,function(t,e){null!==t&&"undefined"!=typeof t&&(i.isArray(t)&&(e+="[]"),i.isArray(t)||(t=[t]),i.forEach(t,function(t){i.isDate(t)?t=t.toISOString():i.isObject(t)&&(t=JSON.stringify(t)),a.push(r(e)+"="+r(t))}))}),o=a.join("&")}return o&&(t+=(t.indexOf("?")===-1?"?":"&")+o),t}},function(t,e,n){var r=n(2);t.exports=function(t){var e,n,i,o={};return t?(r.forEach(t.split("\n"),function(t){i=t.indexOf(":"),e=r.trim(t.substr(0,i)).toLowerCase(),n=r.trim(t.substr(i+1)),e&&(o[e]=o[e]?o[e]+", "+n:n)}),o):o}},function(t,e,n){var r=n(2);t.exports=r.isStandardBrowserEnv()?function(){function t(t){var e=t;return n&&(i.setAttribute("href",e),e=i.href),i.setAttribute("href",e),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}var e,n=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");return e=t(window.location.href),function(n){var i=r.isString(n)?t(n):n;return i.protocol===e.protocol&&i.host===e.host}}():function(){return function(){return!0}}()},function(t,e){function n(){this.message="String contains an invalid character"}function r(t){for(var e,r,o=String(t),a="",s=0,u=i;o.charAt(0|s)||(u="=",s%1);a+=u.charAt(63&e>>8-s%1*8)){if(r=o.charCodeAt(s+=.75),r>255)throw new n;e=e<<8|r}return a}var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.code=5,n.prototype.name="InvalidCharacterError",t.exports=r},function(t,e,n){var r=n(2);t.exports=r.isStandardBrowserEnv()?function(){return{write:function(t,e,n,i,o,a){var s=[];s.push(t+"="+encodeURIComponent(e)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(i)&&s.push("path="+i),r.isString(o)&&s.push("domain="+o),a===!0&&s.push("secure"),document.cookie=s.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()},function(t,e){t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,e){t.exports=function(t,e){return t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,"")}},function(t,e){t.exports=function(t){return function(e){return t.apply(null,e)}}}])})}),v=n(y),m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},g=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},b=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),w=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[n.length-1];return this.dbg.apply(this,[i.op].concat(n)),e.utils.resolve()},x=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[n.length-2];return this.dbg.apply(this,[i.op].concat(n)),e.utils.resolve()},A=function(t){var e={},n=[];return t.forEach(function(t){t in e||(n.push(t),e[t]=0)}),n},T=function(t,n,r){r||(r={}),r.with||(r.with=[]);var i=t.relationFields||[],o=i.filter(function(t){return r.with.indexOf(t)===-1});return e.utils.omit(n,o)},E={debug:!1,raw:!1};e.Component.extend({constructor:o,afterCount:x,afterCreate:x,afterCreateMany:x,afterDestroy:x,afterDestroyAll:x,afterFind:x,afterFindAll:x,afterSum:x,afterUpdate:x,afterUpdateAll:x,afterUpdateMany:x,beforeCount:w,beforeCreate:w,beforeCreateMany:w,beforeDestroy:w,beforeDestroyAll:w,beforeFind:w,beforeFindAll:w,beforeSum:w,beforeUpdate:w,beforeUpdateAll:w,beforeUpdateMany:w,count:function(t,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeCount",e.utils.resolve(this[a](t,n,r)).then(function(){return a=r.op="count",o.dbg(a,t,n,r),e.utils.resolve(o._count(t,n,r))}).then(function(s){var u=b(s,2),f=u[0],l=u[1];l||(l={});var c=new i(f,l,a);return c=o.respond(c,r),a=r.op="afterCount",e.utils.resolve(o[a](t,n,r,c)).then(function(t){return void 0===t?c:t})})},create:function(t,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeCreate",e.utils.resolve(this[a](t,n,r)).then(function(i){return n=void 0===i?n:i,n=T(t,n,r),a=r.op="create",o.dbg(a,t,n,r),e.utils.resolve(o._create(t,n,r))}).then(function(s){var u=b(s,2),f=u[0],l=u[1];l||(l={});var c=new i(f,l,"create");return c.created=f?1:0,c=o.respond(c,r),a=r.op="afterCreate",e.utils.resolve(o[a](t,n,r,c)).then(function(t){return void 0===t?c:t})})},createMany:function(t,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeCreateMany",e.utils.resolve(this[a](t,n,r)).then(function(i){return n=void 0===i?n:i,n=n.map(function(e){return T(t,e,r)}),a=r.op="createMany",o.dbg(a,t,n,r),e.utils.resolve(o._createMany(t,n,r))}).then(function(s){var u=b(s,2),f=u[0],l=u[1];f||(f=[]),l||(l={});var c=new i(f,l,"createMany");return c.created=f.length,c=o.respond(c,r),a=r.op="afterCreateMany",e.utils.resolve(o[a](t,n,r,c)).then(function(t){return void 0===t?c:t})})},destroy:function(t,n,r){var o=this,a=void 0;return r||(r={}),a=r.op="beforeDestroy",e.utils.resolve(this[a](t,n,r)).then(function(){return a=r.op="destroy",o.dbg(a,t,n,r),e.utils.resolve(o._destroy(t,n,r))}).then(function(s){var u=b(s,2),f=u[0],l=u[1];l||(l={});var c=new i(f,l,"destroy");return c=o.respond(c,r),a=r.op="afterDestroy",e.utils.resolve(o[a](t,n,r,c)).then(function(t){return void 0===t?c:t})})},destroyAll:function(t,n,r){var o=this,a=void 0;return n||(n={}),r||(r={}),a=r.op="beforeDestroyAll",e.utils.resolve(this[a](t,n,r)).then(function(){return a=r.op="destroyAll",o.dbg(a,t,n,r),e.utils.resolve(o._destroyAll(t,n,r))}).then(function(s){var u=b(s,2),f=u[0],l=u[1];l||(l={});var c=new i(f,l,"destroyAll");return c=o.respond(c,r),a=r.op="afterDestroyAll",e.utils.resolve(o[a](t,n,r,c)).then(function(t){return void 0===t?c:t})})},loadBelongsTo:function(t,n,r,i){var o=this,a=n.getRelation();if(!e.utils.isObject(r)||e.utils.isArray(r)){var s=r.map(function(e){return o.makeBelongsToForeignKey(t,n,e)}).filter(function(t){return t});return this.findAll(a,{where:g({},a.idAttribute,{in:s})},i).then(function(t){r.forEach(function(e){t.forEach(function(t){t[a.idAttribute]===e[n.foreignKey]&&n.setLocalField(e,t)})})})}var u=function(){var e=r;return{v:o.find(a,o.makeBelongsToForeignKey(t,n,e),i).then(function(t){n.setLocalField(e,t)})}}();if("object"===("undefined"==typeof u?"undefined":m(u)))return u.v},find:function(t,n,r){var o=this,a=void 0,s=void 0,u={};return r||(r={}),r.with||(r.with=[]),s=r.op="beforeFind",e.utils.resolve(this[s](t,n,r)).then(function(){return s=r.op="find",o.dbg(s,t,n,r),e.utils.resolve(o._find(t,n,r))}).then(function(n){var i=b(n,2),s=i[0],f=i[1];if(s){a=s,u=f;var l=[];return e.utils.forEachRelation(t,r,function(e,n){var r=void 0;!e.foreignKey||"hasOne"!==e.type&&"hasMany"!==e.type?"hasMany"===e.type&&e.localKeys?r=o.loadHasManyLocalKeys(t,e,a,n):"hasMany"===e.type&&e.foreignKeys?r=o.loadHasManyForeignKeys(t,e,a,n):"belongsTo"===e.type&&(r=o.loadBelongsTo(t,e,a,n)):r="hasOne"===e.type?o.loadHasOne(t,e,a,n):o.loadHasMany(t,e,a,n),r&&l.push(r)}),e.utils.Promise.all(l)}}).then(function(){var f=new i(a,u,"find");return f.found=a?1:0,f=o.respond(f,r),s=r.op="afterFind",e.utils.resolve(o[s](t,n,r,f)).then(function(t){return void 0===t?f:t})})},findAll:function(t,n,r){var o=this;r||(r={}),r.with||(r.with=[]);var a=[],s={},u=void 0,f=r._activeWith;if(e.utils.isObject(f)){var l=f.query||{};f.replace?n=l:e.utils.deepFillIn(n,l)}return u=r.op="beforeFindAll",e.utils.resolve(this[u](t,n,r)).then(function(){return u=r.op="findAll",o.dbg(u,t,n,r),e.utils.resolve(o._findAll(t,n,r))}).then(function(n){var i=b(n,2),u=i[0],f=i[1];u||(u=[]),a=u,s=f;var l=[];return e.utils.forEachRelation(t,r,function(e,n){var r=void 0;!e.foreignKey||"hasOne"!==e.type&&"hasMany"!==e.type?"hasMany"===e.type&&e.localKeys?r=o.loadHasManyLocalKeys(t,e,a,n):"hasMany"===e.type&&e.foreignKeys?r=o.loadHasManyForeignKeys(t,e,a,n):"belongsTo"===e.type&&(r=o.loadBelongsTo(t,e,a,n)):r="hasMany"===e.type?o.loadHasMany(t,e,a,n):o.loadHasOne(t,e,a,n),r&&l.push(r)}),e.utils.Promise.all(l)}).then(function(){var f=new i(a,s,"findAll");return f.found=a.length,f=o.respond(f,r),u=r.op="afterFindAll",e.utils.resolve(o[u](t,n,r,f)).then(function(t){return void 0===t?f:t})})},getOpt:function(t,n){return n||(n={}),void 0===n[t]?e.utils.plainCopy(this[t]):e.utils.plainCopy(n[t])},loadHasMany:function(t,n,r,i){var o=this,a=!1;e.utils.isObject(r)&&!e.utils.isArray(r)&&(a=!0,r=[r]);var s=r.map(function(e){return o.makeHasManyForeignKey(t,n,e)}),u={where:{}},f=u.where[n.foreignKey]={};return a?f["=="]=s[0]:f.in=s.filter(function(t){return t}),this.findAll(n.getRelation(),u,i).then(function(i){r.forEach(function(r){var o=[];a?o=i:i.forEach(function(i){e.utils.get(i,n.foreignKey)===r[t.idAttribute]&&o.push(i)}),n.setLocalField(r,o)})})},loadHasManyLocalKeys:function(t,n,r,i){var o=this,a=void 0,s=n.getRelation();if(e.utils.isObject(r)&&!e.utils.isArray(r)&&(a=r),a)return this.findAll(s,{where:g({},s.idAttribute,{in:this.makeHasManyLocalKeys(t,n,a)})},i).then(function(t){n.setLocalField(a,t)});var u=function(){var a=[];return r.forEach(function(e){a=a.concat(o.makeHasManyLocalKeys(t,n,e))}),{v:o.findAll(s,{where:g({},s.idAttribute,{in:A(a).filter(function(t){return t})})},i).then(function(t){return r.forEach(function(r){var i=[],o=e.utils.get(r,n.localKeys)||[];o=e.utils.isArray(o)?o:Object.keys(o),t.forEach(function(t){o&&o.indexOf(t[s.idAttribute])!==-1&&i.push(t)}),n.setLocalField(r,i)}),t})}}();return"object"===("undefined"==typeof u?"undefined":m(u))?u.v:void 0},loadHasManyForeignKeys:function(t,n,r,i){var o=this,a=n.getRelation(),s=t.idAttribute,u=void 0;return e.utils.isObject(r)&&!e.utils.isArray(r)&&(u=r),u?this.findAll(n.getRelation(),{where:g({},n.foreignKeys,{contains:this.makeHasManyForeignKeys(t,n,u)})},i).then(function(t){n.setLocalField(u,t)}):this.findAll(a,{where:g({},n.foreignKeys,{isectNotEmpty:r.map(function(e){return o.makeHasManyForeignKeys(t,n,e)})})},i).then(function(t){var i=n.foreignKeys;r.forEach(function(r){var o=[],a=e.utils.get(r,s);t.forEach(function(n){var r=e.utils.get(t,i)||[];r.indexOf(a)!==-1&&o.push(n)}),n.setLocalField(r,o)})})},loadHasOne:function(t,n,r,i){return e.utils.isObject(r)&&!e.utils.isArray(r)&&(r=[r]),this.loadHasMany(t,n,r,i).then(function(){r.forEach(function(t){var r=n.getLocalField(t);e.utils.isArray(r)&&r.length&&n.setLocalField(t,r[0])})})},makeHasManyForeignKey:function(t,e,n){return e.getForeignKey(n)},makeHasManyLocalKeys:function(t,n,r){var i=[],o=e.utils.get(r,n.localKeys)||[];return o=e.utils.isArray(o)?o:Object.keys(o),i=i.concat(o),A(i).filter(function(t){return t})},makeHasManyForeignKeys:function(t,n,r){return e.utils.get(r,t.idAttribute)},makeBelongsToForeignKey:function(t,e,n){return e.getForeignKey(n)},sum:function(t,n,r,o){var a=this,s=void 0;if(!e.utils.isString(n))throw new Error("field must be a string!");return r||(r={}),o||(o={}),s=o.op="beforeSum",e.utils.resolve(this[s](t,n,r,o)).then(function(){return s=o.op="sum",a.dbg(s,t,n,r,o),e.utils.resolve(a._sum(t,n,r,o))}).then(function(u){var f=b(u,2),l=f[0],c=f[1];c||(c={});var d=new i(l,c,s);return d=a.respond(d,o),s=o.op="afterSum",e.utils.resolve(a[s](t,n,r,o,d)).then(function(t){return void 0===t?d:t})})},respond:function(t,e){return this.getOpt("raw",e)?t:t.data},update:function(t,n,r,o){var a=this;r||(r={}),o||(o={});var s=void 0;return s=o.op="beforeUpdate",e.utils.resolve(this[s](t,n,r,o)).then(function(i){return r=void 0===i?r:i,r=T(t,r,o),s=o.op="update",a.dbg(s,t,n,r,o),e.utils.resolve(a._update(t,n,r,o))}).then(function(u){var f=b(u,2),l=f[0],c=f[1];c||(c={});var d=new i(l,c,"update");return d.updated=l?1:0,d=a.respond(d,o),s=o.op="afterUpdate",e.utils.resolve(a[s](t,n,r,o,d)).then(function(t){return void 0===t?d:t})})},updateAll:function(t,n,r,o){var a=this;n||(n={}),r||(r={}),o||(o={});var s=void 0;return s=o.op="beforeUpdateAll",e.utils.resolve(this[s](t,n,r,o)).then(function(i){return n=void 0===i?n:i,n=T(t,n,o),s=o.op="updateAll",a.dbg(s,t,n,r,o),e.utils.resolve(a._updateAll(t,n,r,o))}).then(function(u){var f=b(u,2),l=f[0],c=f[1];l||(l=[]),c||(c={});var d=new i(l,c,"updateAll");return d.updated=l.length,d=a.respond(d,o),s=o.op="afterUpdateAll",e.utils.resolve(a[s](t,n,r,o,d)).then(function(t){return void 0===t?d:t})})},updateMany:function(t,n,r){var o=this;n||(n=[]),r||(r={});var a=void 0,s=t.idAttribute;return n=n.filter(function(t){return e.utils.get(t,s)}),a=r.op="beforeUpdateMany",e.utils.resolve(this[a](t,n,r)).then(function(i){return n=void 0===i?n:i,n=n.map(function(e){return T(t,e,r)}),a=r.op="updateMany",o.dbg(a,t,n,r),e.utils.resolve(o._updateMany(t,n,r))}).then(function(s){var u=b(s,2),f=u[0],l=u[1];f||(f=[]),l||(l={});var c=new i(f,l,"updateMany");return c.updated=f.length,c=o.respond(c,r),a=r.op="afterUpdateMany",e.utils.resolve(o[a](t,n,r,c)).then(function(t){return void 0===t?c:t})})}});var S=!1;try{S=window&&window.fetch}catch(t){}var P={basePath:"",forceTrailingSlash:!1,http:v,httpConfig:{},suffix:"",useFetch:!1};o.extend({constructor:c,afterDEL:x,afterGET:x,afterHTTP:x,afterPOST:x,afterPUT:x,beforeDEL:w,beforeGET:w,beforeHTTP:w,beforePOST:w,beforePUT:w,_count:function(t,e,n){var r=this;return this.GET(this.getPath("count",t,n.params,n),n).then(function(e){return r._end(t,n,e)})},_create:function(t,e,n){var r=this;return this.POST(this.getPath("create",t,e,n),this.serialize(t,e,n),n).then(function(e){return r._end(t,n,e)})},_createMany:function(t,e,n){var r=this;return this.POST(this.getPath("createMany",t,null,n),this.serialize(t,e,n),n).then(function(e){return r._end(t,n,e)})},_destroy:function(t,e,n){var r=this;return this.DEL(this.getPath("destroy",t,e,n),n).then(function(e){return r._end(t,n,e)})},_destroyAll:function(t,e,n){var r=this;return this.DEL(this.getPath("destroyAll",t,null,n),n).then(function(e){return r._end(t,n,e)})},_end:function(t,e,n){return[this.deserialize(t,n,e),n]},_find:function(t,e,n){var r=this;return this.GET(this.getPath("find",t,e,n),n).then(function(e){return r._end(t,n,e)})},_findAll:function(t,e,n){var r=this;return this.GET(this.getPath("findAll",t,n.params,n),n).then(function(e){return r._end(t,n,e)})},_sum:function(t,e,n,r){var i=this;return this.GET(this.getPath("sum",t,r.params,r),r).then(function(e){return i._end(t,r,e)})},_update:function(t,e,n,r){var i=this;return this.PUT(this.getPath("update",t,e,r),this.serialize(t,n,r),r).then(function(e){return i._end(t,r,e)})},_updateAll:function(t,e,n,r){var i=this;return this.PUT(this.getPath("updateAll",t,null,r),this.serialize(t,e,r),r).then(function(e){return i._end(t,r,e)})},_updateMany:function(t,e,n){var r=this;return this.PUT(this.getPath("updateMany",t,null,n),this.serialize(t,e,n),n).then(function(e){return r._end(t,n,e)})},count:function(t,n,r){return n||(n={}),r||(r={}),r.params=this.getParams(r),r.params.count=!0,r.suffix=this.getSuffix(t,r),e.utils.deepMixIn(r.params,n),r.params=this.queryTransform(t,r.params,r),o.prototype.count.call(this,t,n,r)},create:function(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),o.prototype.create.call(this,t,e,n)},createMany:function(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),o.prototype.createMany.call(this,t,e,n)},DEL:function(t,n,r){var i=this,o=void 0;return n||(n={}),r||(r={}),n.url=t||n.url,n.method=n.method||"delete",o=r.op="beforeDEL",e.utils.resolve(this[o](t,n,r)).then(function(e){return n=void 0===e?n:e,o=r.op="DEL",i.dbg(o,t,n,r),i.HTTP(n,r)}).then(function(a){return o=r.op="afterDEL",e.utils.resolve(i[o](t,n,r,a)).then(function(t){return void 0===t?a:t})})},deserialize:function(t,n,r){return r||(r={}),e.utils.isFunction(r.deserialize)?r.deserialize(t,n,r):e.utils.isFunction(t.deserialize)?t.deserialize(t,n,r):n&&n.hasOwnProperty("data")?n.data:n},destroy:function(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),o.prototype.destroy.call(this,t,e,n)},destroyAll:function(t,n,r){return n||(n={}),r||(r={}),r.params=this.getParams(r),e.utils.deepMixIn(r.params,n),r.params=this.queryTransform(t,r.params,r),r.suffix=this.getSuffix(t,r),o.prototype.destroyAll.call(this,t,n,r)},error:function(){if(console){var t;(t=console)["function"==typeof console.error?"error":"log"].apply(t,arguments)}},fetch:function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,n){var r={method:t.method,headers:new Headers(t.headers)};return t.data&&(r.body=e.utils.toJson(t.data)),fetch(new Request(l(t.url,t.params),r)).then(function(e){return e.config={method:t.method,url:t.url},e.json().then(function(t){return e.data=t,e})})}),find:function(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),o.prototype.find.call(this,t,e,n)},findAll:function(t,n,r){return n||(n={}),r||(r={}),r.params=this.getParams(r),r.suffix=this.getSuffix(t,r),e.utils.deepMixIn(r.params,n),r.params=this.queryTransform(t,r.params,r),o.prototype.findAll.call(this,t,n,r)},GET:function(t,n,r){var i=this,o=void 0;return n||(n={}),r||(r={}),n.url=t||n.url,n.method=n.method||"get",o=r.op="beforeGET",e.utils.resolve(this[o](t,n,r)).then(function(e){return n=void 0===e?n:e,o=r.op="GET",i.dbg(o,t,n,r),i.HTTP(n,r)}).then(function(a){return o=r.op="afterGET",e.utils.resolve(i[o](t,n,r,a)).then(function(t){return void 0===t?a:t})})},getEndpoint:function(t,n,r){var i=this;r||(r={}),r.params=e.utils.isUndefined(r.params)?{}:r.params;var o=t.relationList||[],a=e.utils.isUndefined(r.endpoint)?e.utils.isUndefined(t.endpoint)?t.name:t.endpoint:r.endpoint;return o.forEach(function(t){if("belongsTo"===t.type&&t.parent){var o=void 0,s=t.foreignKey,f=t.getRelation(),l=r.params[s];if(l===!1||!s||!f)return l===!1&&delete r.params[s],!1;if(delete r.params[s],e.utils.isObject(n)&&(o=n),o&&(l=l||t.getForeignKey(o)||(t.getLocalField(o)?e.utils.get(t.getLocalField(o),f.idAttribute):null)),l){var c=function(){delete r.endpoint;var t={};return e.utils.forOwn(r,function(e,n){t[n]=e}),e.utils._(t,f),a=u(i.getEndpoint(f,l,t),l,a),{v:!1}}();if("object"===("undefined"==typeof c?"undefined":m(c)))return c.v}}}),a},getPath:function(t,n,r,i){i||(i={});var o=[void 0===i.basePath?void 0===n.basePath?this.basePath:n.basePath:i.basePath,this.getEndpoint(n,e.utils.isString(r)||e.utils.isNumber(r)||"create"===t?r:null,i)];return"find"!==t&&"update"!==t&&"destroy"!==t||o.push(r),u.apply(e.utils,o)},getParams:function(t){return t||(t={}),void 0===t.params?{}:e.utils.copy(t.params)},getSuffix:function(t,e){return e||(e={}),void 0===e.suffix?void 0===t.suffix?this.suffix:t.suffix:e.suffix},HTTP:function(t,n){var r=this,i=new Date;n||(n={});var o=t.data,a=t.cache,s=t.timeout;t=e.utils.copy(t,null,null,null,["data","cache","timeout"]),t=e.utils.deepMixIn(t,this.httpConfig),t.data=o,t.cache=a,t.timeout=s,this.forceTrailingSlash&&"/"!==t.url[t.url.length-1]&&(t.url+="/"),t.method=t.method.toUpperCase();var u=t.suffix||n.suffix||this.suffix;u&&t.url.substr(t.url.length-u.length)!==u&&(t.url+=u);var f=function(n){var o=i.toUTCString()+" - "+t.method.toUpperCase()+" "+t.url+" - "+n.status+" "+((new Date).getTime()-i.getTime())+"ms";return n.status>=200&&n.status<300?(r.log&&r.dbg(o,n),n):(r.error&&r.error("'FAILED: "+o,n),e.utils.reject(n))};if(!this.http)throw new Error("You have not configured this adapter with an http library!");return e.utils.resolve(this.beforeHTTP(t,n)).then(function(e){return t=e||t,S&&(r.useFetch||n.useFetch||!r.http)?r.fetch(t,n).then(f,f):r.http(t).then(f,f).catch(function(e){return r.responseError(e,t,n)})}).then(function(i){return e.utils.resolve(r.afterHTTP(t,n,i)).then(function(t){return void 0===t?i:t})})},POST:function(t,n,r,i){var o=this,a=void 0;return r||(r={}),i||(i={}),r.url=t||r.url,r.data=n||r.data,r.method=r.method||"post",a=i.op="beforePOST",e.utils.resolve(this[a](t,n,r,i)).then(function(e){return r=void 0===e?r:e,a=i.op="POST",o.dbg(a,t,n,r,i),o.HTTP(r,i)}).then(function(s){return a=i.op="afterPOST",e.utils.resolve(o[a](t,n,r,i,s)).then(function(t){return void 0===t?s:t})})},PUT:function(t,n,r,i){var o=this,a=void 0;return r||(r={}),i||(i={}),r.url=t||r.url,r.data=n||r.data,r.method=r.method||"put",a=i.op="beforePUT",e.utils.resolve(this[a](t,n,r,i)).then(function(e){return r=void 0===e?r:e,
a=i.op="PUT",o.dbg(a,t,n,r,i),o.HTTP(r,i)}).then(function(s){return a=i.op="afterPUT",e.utils.resolve(o[a](t,n,r,i,s)).then(function(t){return void 0===t?s:t})})},queryTransform:function(t,n,r){return r||(r={}),e.utils.isFunction(r.queryTransform)?r.queryTransform(t,n,r):e.utils.isFunction(t.queryTransform)?t.queryTransform(t,n,r):n},responseError:function(t,n,r){return e.utils.reject(t)},serialize:function(t,n,r){return r||(r={}),e.utils.isFunction(r.serialize)?r.serialize(t,n,r):e.utils.isFunction(t.serialize)?t.serialize(t,n,r):n},sum:function(t,n,r,i){if(r||(r={}),i||(i={}),!e.utils.utils.isString(n))throw new Error("field must be a string!");return i.params=this.getParams(i),i.params.sum=n,i.suffix=this.getSuffix(t,i),e.utils.deepMixIn(i.params,r),i.params=this.queryTransform(t,i.params,i),o.prototype.sum.call(this,t,n,r,i)},update:function(t,e,n,r){return r||(r={}),r.params=this.getParams(r),r.params=this.queryTransform(t,r.params,r),r.suffix=this.getSuffix(t,r),o.prototype.update.call(this,t,e,n,r)},updateAll:function(t,n,r,i){return r||(r={}),i||(i={}),i.params=this.getParams(i),e.utils.deepMixIn(i.params,r),i.params=this.queryTransform(t,i.params,i),i.suffix=this.getSuffix(t,i),o.prototype.updateAll.call(this,t,n,r,i)},updateMany:function(t,e,n){return n||(n={}),n.params=this.getParams(n),n.params=this.queryTransform(t,n.params,n),n.suffix=this.getSuffix(t,n),o.prototype.updateMany.call(this,t,e,n)}});var M={full:"3.0.0-rc.2",major:3,minor:0,patch:0};t.HttpAdapter=c,t.addAction=d,t.addActions=p,t.version=M,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=js-data-http.min.map